"""
改善版プロンプト案
"""

# 元プロンプト
PROMPT = """
以降のユーザープロンプトで示されるテキストは半導体露光装置における{basename}という機能仕様書から「明示的に記載されている」事実のみを項目別に抽出したものです。
抽出した事実は以下の通りです。

## 整理された事実
{markdown_text}

## タスク
これらの事実を統合し、「{basename}」の現行仕様の解説ドキュメントを作成せよ。

## 解説の構成
1. 機能概要（目的、全体像）
2. インターフェース仕様（入出力）
3. 処理フロー
4. 制約・エラー処理
5. 依存関係・前提条件

## 制約
- 上記の事実に含まれない情報は記載しない
- 矛盾がある箇所は両論併記し、出典を明記する
- 推測や補完は行わない
- フローなどダイアグラムで

"""

# バージョン1: 基本的な改善（追加要件を反映）
PROMPT_V1 = """
以降のユーザープロンプトで示されるテキストは、半導体露光装置における「{basename}」機能の仕様書から抽出した事実群です。
これらの事実を統合し、技術者が理解しやすい解説ドキュメントを作成してください。

## 抽出された事実
{markdown_text}

## タスク
上記の事実のみを用いて、「{basename}」の現行仕様解説を作成せよ。

## 出力構成

### 1. 機能概要
- **目的**: この機能が何のために存在するか
- **全体像**: 主要な役割と位置づけ
- **適用範囲**: どのような場面で使用されるか

### 2. インターフェース仕様
- **入力**: 受け取るデータ・信号（型、範囲、制約）
- **出力**: 返却するデータ・結果（型、範囲、意味）
- **副作用**: 状態変更や外部への影響

### 3. 処理フロー
- **正常系**: 標準的な処理の流れ
- **分岐条件**: 条件による処理の分岐
- **状態遷移**: 状態がある場合、その遷移図

### 4. 制約・エラー処理
- **内部制約**: 当該機能内での制約事項
  - パラメータ範囲、タイミング制約、リソース制限など
- **外部制約**: 他機能から課される制約
  - 呼び出し順序、前提条件、排他制御など
- **エラー処理**: エラー検出条件と対処方法

### 5. 依存関係・前提条件
- **内部依存**: 当該機能内での依存関係
  - 処理順序、データ依存、状態依存など
- **外部依存**: 他機能との依存関係
  - 必要な機能、連携する機能、影響を与える機能など
- **前提条件**: 機能実行前に満たすべき条件

## 記述ルール
1. **事実ベース**: 提供された事実のみを記載（推測・補完禁止）
2. **出典明記**: 矛盾がある場合は両論併記し、出典を明示
3. **構造化**: 箇条書きと見出しを活用し、読みやすく整理
4. **具体性**: 抽象的な表現を避け、具体的な値や条件を記載
5. **未記載の明示**: 情報がない項目は「記載なし」と明記

## 出力フォーマット
Markdown形式で、上記の構成に従って記述してください。
"""


# バージョン2: より詳細な指示（Few-shot例付き）
PROMPT_V2 = """
以降のユーザープロンプトで示されるテキストは、半導体露光装置における「{basename}」機能の仕様書から抽出した事実群です。
これらの事実を統合し、保守性の高い技術解説ドキュメントを作成してください。

## 抽出された事実
{markdown_text}

---

## 作成する解説ドキュメントの構成

### 1. 機能概要
**目的**: この機能が解決する課題・実現する価値
**全体像**: システム内での位置づけと主要な責務
**適用範囲**: 使用されるシーン・条件

### 2. インターフェース仕様
**入力**:
- パラメータ名、型、有効範囲、デフォルト値
- 例: `exposure_time (float, 0.1-10.0秒, デフォルト1.0)`

**出力**:
- 戻り値の型、意味、取りうる値
- 例: `Status (enum): SUCCESS | ERROR_TIMEOUT | ERROR_INVALID_PARAM`

**副作用**:
- 状態変更、ファイル出力、ハードウェア制御など

### 3. 処理フロー
**正常系**:
1. ステップを順序立てて記述
2. 各ステップの目的を明記

**分岐条件**:
- 条件 → 処理A / 処理B のように明示

**状態遷移**:
- 状態がある場合: IDLE → RUNNING → COMPLETE のように記述

### 4. 制約・エラー処理

#### 4.1 内部制約（当該機能内）
- **パラメータ制約**: 
  - 例: `exposure_time は 0.1秒以上10.0秒以下`
- **タイミング制約**:
  - 例: `前回実行から100ms以上の間隔が必要`
- **リソース制約**:
  - 例: `メモリ使用量は最大100MB`

#### 4.2 外部制約（他機能から課される）
- **呼び出し制約**:
  - 例: `機能Aの実行後にのみ呼び出し可能`
- **排他制御**:
  - 例: `機能Bと同時実行不可`
- **依存順序**:
  - 例: `機能C→機能D→本機能の順序で実行必須`

#### 4.3 エラー処理
| エラー条件 | 検出方法 | 対処 |
|-----------|---------|------|
| 例: タイムアウト | 10秒以内に応答なし | ERROR_TIMEOUT返却、状態をIDLEに戻す |

### 5. 依存関係・前提条件

#### 5.1 内部依存（当該機能内）
- **処理順序依存**:
  - 例: `初期化→設定→実行→終了処理の順序必須`
- **データ依存**:
  - 例: `設定Aが完了していないと設定Bは実行不可`
- **状態依存**:
  - 例: `READY状態でのみ実行可能`

#### 5.2 外部依存（他機能との関係）
- **必須機能**:
  - 例: `機能X（初期化用）が事前実行済みであること`
- **連携機能**:
  - 例: `機能Yと協調動作（データ受け渡し）`
- **影響を与える機能**:
  - 例: `機能Zの状態を変更する`

#### 5.3 前提条件
- **ハードウェア前提**:
  - 例: `センサーAが接続済み`
- **ソフトウェア前提**:
  - 例: `設定ファイルconfig.xmlが存在`
- **システム状態前提**:
  - 例: `システムがSTANDBYモード以上`

---

## 記述ルール

### 必須ルール
✅ **事実ベース**: 提供された事実のみを記載
✅ **推測禁止**: 「おそらく」「一般的に」等の推測表現を使わない
✅ **未記載明示**: 情報がない項目は「**記載なし**」と明記
✅ **矛盾処理**: 矛盾がある場合は両論併記し、出典を明示

### 推奨スタイル
📝 **具体的**: 抽象的表現を避け、具体的な値・条件を記載
📝 **構造化**: 箇条書き、表、コードブロックを活用
📝 **一貫性**: 用語を統一（例: 「エラー」と「例外」を混在させない）
📝 **追跡可能**: 重要な記述には出典（セクション名）を付記

---

## 出力例（部分）

### 4. 制約・エラー処理

#### 4.1 内部制約（当該機能内）
- **パラメータ制約**:
  - `exposure_time`: 0.1秒以上10.0秒以下（出典: パラメータ仕様）
  - `resolution`: 1nm, 5nm, 10nmのいずれか（出典: 設定値一覧）

- **タイミング制約**:
  - 前回実行から最低100ms必要（出典: 処理タイミング要件）

#### 4.2 外部制約（他機能から課される）
- **呼び出し制約**:
  - `InitializeStage()`実行後にのみ呼び出し可能（出典: 初期化シーケンス）
  
- **排他制御**:
  - `CalibrationMode`と同時実行不可（出典: 排他制御一覧）

---

## 最終チェックリスト
回答前に以下を確認してください：
□ 全ての項目に記載があるか（「記載なし」含む）
□ 推測・補完していないか
□ 内部/外部の区別が明確か
□ 矛盾がある場合、両論併記しているか
□ 具体的な値・条件を記載しているか
"""


# バージョン3: システムプロンプトとユーザープロンプトを分離
SYSTEM_PROMPT_V3 = """
あなたは半導体露光装置の技術文書を作成する専門家です。
与えられた事実のみを用いて、正確で保守性の高い解説ドキュメントを作成してください。

## 重要な原則
1. **事実ベース**: 提供された情報のみを使用（推測・一般知識の補完禁止）
2. **明示性**: 情報がない項目は「記載なし」と明記
3. **追跡可能性**: 重要な記述には出典を付記
4. **構造化**: 読みやすく、検索しやすい構造

## 禁止事項
❌ 推測・類推による情報補完
❌ 一般的な知識の追加
❌ 曖昧な表現（「おそらく」「通常」「一般的に」等）
❌ 矛盾の隠蔽（矛盾がある場合は両論併記すること）
"""

USER_PROMPT_V3 = """
以下は半導体露光装置における「{basename}」機能の仕様書から抽出した事実群です。

## 抽出された事実
{markdown_text}

---

## タスク
上記の事実を統合し、「{basename}」の技術解説ドキュメントを作成してください。

## 出力構成

### 1. 機能概要
- 目的（この機能が解決する課題）
- 全体像（システム内での位置づけ）
- 適用範囲（使用されるシーン）

### 2. インターフェース仕様
- 入力（パラメータ、型、範囲、デフォルト値）
- 出力（戻り値、型、意味）
- 副作用（状態変更、外部影響）

### 3. 処理フロー
- 正常系（標準的な流れ）
- 分岐条件（条件分岐）
- 状態遷移（状態がある場合）

### 4. 制約・エラー処理
**4.1 内部制約（当該機能内）**
- パラメータ制約（範囲、型、組み合わせ）
- タイミング制約（実行間隔、順序）
- リソース制約（メモリ、CPU、ファイル）

**4.2 外部制約（他機能から課される）**
- 呼び出し制約（前提となる機能実行）
- 排他制御（同時実行不可の機能）
- 依存順序（実行順序の制約）

**4.3 エラー処理**
- エラー条件と対処方法（表形式推奨）

### 5. 依存関係・前提条件
**5.1 内部依存（当該機能内）**
- 処理順序依存
- データ依存
- 状態依存

**5.2 外部依存（他機能との関係）**
- 必須機能（事前実行が必要）
- 連携機能（データ受け渡し）
- 影響先機能（当該機能が影響を与える）

**5.3 前提条件**
- ハードウェア前提
- ソフトウェア前提
- システム状態前提

## 記述ルール
- 情報がない項目: 「**記載なし**」と明記
- 矛盾がある場合: 両論併記し出典を明示
- 具体的な値・条件を優先
- Markdown形式で構造化

上記の構成に従って解説ドキュメントを作成してください。
"""


# バージョン4: JSON schema風の厳密な構造指定
PROMPT_V4 = """
以降のユーザープロンプトで示されるテキストは、半導体露光装置における「{basename}」機能の仕様書から抽出した事実群です。

## 抽出された事実
{markdown_text}

---

## タスク
上記の事実のみを用いて、以下の構造に厳密に従った解説ドキュメントを作成せよ。

## 出力構造（必須項目）

```markdown
# {basename} - 機能解説

## 1. 機能概要
### 1.1 目的
[この機能が解決する課題・実現する価値]

### 1.2 全体像
[システム内での位置づけと主要な責務]

### 1.3 適用範囲
[使用されるシーン・条件]

---

## 2. インターフェース仕様
### 2.1 入力
| パラメータ名 | 型 | 範囲 | デフォルト | 説明 | 出典 |
|-------------|---|------|-----------|------|------|
| ... | ... | ... | ... | ... | ... |

### 2.2 出力
| 項目 | 型 | 値 | 説明 | 出典 |
|-----|---|-----|------|------|
| ... | ... | ... | ... | ... |

### 2.3 副作用
- [状態変更、外部影響など]

---

## 3. 処理フロー
### 3.1 正常系
```
1. [ステップ1の説明]
2. [ステップ2の説明]
...
```

### 3.2 分岐条件
```
IF [条件] THEN
  [処理A]
ELSE
  [処理B]
```

### 3.3 状態遷移
```
[状態A] --[イベント]--> [状態B]
```

---

## 4. 制約・エラー処理
### 4.1 内部制約（当該機能内）
#### パラメータ制約
- [制約内容]（出典: [セクション名]）

#### タイミング制約
- [制約内容]（出典: [セクション名]）

#### リソース制約
- [制約内容]（出典: [セクション名]）

### 4.2 外部制約（他機能から課される）
#### 呼び出し制約
- [制約内容]（出典: [セクション名]）

#### 排他制御
- [制約内容]（出典: [セクション名]）

#### 依存順序
- [制約内容]（出典: [セクション名]）

### 4.3 エラー処理
| エラー条件 | 検出方法 | 対処 | 出典 |
|-----------|---------|------|------|
| ... | ... | ... | ... |

---

## 5. 依存関係・前提条件
### 5.1 内部依存（当該機能内）
#### 処理順序依存
- [依存関係]（出典: [セクション名]）

#### データ依存
- [依存関係]（出典: [セクション名]）

#### 状態依存
- [依存関係]（出典: [セクション名]）

### 5.2 外部依存（他機能との関係）
#### 必須機能
- [機能名]: [依存内容]（出典: [セクション名]）

#### 連携機能
- [機能名]: [連携内容]（出典: [セクション名]）

#### 影響先機能
- [機能名]: [影響内容]（出典: [セクション名]）

### 5.3 前提条件
#### ハードウェア前提
- [前提条件]（出典: [セクション名]）

#### ソフトウェア前提
- [前提条件]（出典: [セクション名]）

#### システム状態前提
- [前提条件]（出典: [セクション名]）

---

## 補足事項
[その他重要な注意事項]
```

## 記述ルール
1. **構造厳守**: 上記の構造を必ず守る（セクション番号、見出しレベル含む）
2. **表の使用**: 可能な限り表形式で整理
3. **出典明記**: 重要な記述には必ず出典を付ける
4. **記載なし明示**: 情報がない場合は「**記載なし**」と明記
5. **事実のみ**: 推測・補完は一切行わない

上記の構造に厳密に従って解説ドキュメントを作成してください。
"""
